<app-RecyclerLayout (sectionChange)="onSectionChange($event)">
  <div class="recycler-requests-content">
    
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container content-card">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading your requests...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container content-card">
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="loadRequests()">Try Again</button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && getFilteredRequests().length === 0" class="empty-container content-card">
      <div class="empty-message">
        <i class="fas fa-inbox"></i>
        <h3>No Requests Found</h3>
        <p *ngIf="selectedStatus === 'all'">
          You haven't made any recycling requests yet. 
          <a routerLink="/Recycler/auctions">Browse available auctions</a> to get started.
        </p>
        <p *ngIf="selectedStatus !== 'all'">
          No requests found with the selected status.
        </p>
      </div>
    </div>

    <!-- Requests Table -->
    <div *ngIf="!loading && !error && getFilteredRequests().length > 0" class="requests-table-section content-card">
      <div class="card-header">
        <i class="fas fa-list-alt"></i>
        <h3>My Recycling Requests</h3>
      </div>
      <div class="card-body">
        <table class="requests-table">
          <thead>
            <tr>
              <th>Request ID</th>
              <th>Auction ID</th>
              <th>Material</th>
              <th>City</th>
              <th>Insurance Amount</th>
              <th>Approval Time</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let request of getFilteredRequests()">
              <td>#{{ request.recyclingRequestId }}</td>
              <td>#{{ request.auctionId }}</td>
              <td>{{ request.matrialName }}</td>
              <td>{{ request.city }}</td>
              <td class="insurance-amount">${{ request.insuranceAmount.toFixed(2) }}</td>
              <td>{{ formatDate(request.approvalTime) }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(request.status)">
                  {{ getStatusText(request.status) }}
                </span>
              </td>
              <td>
                <button 
                  *ngIf="request.status === 1" 
                  class="action-btn withdraw-btn"
                  (click)="withdrawRequest(request.recyclingRequestId, request.auctionId)"
                  title="Withdraw Request">
                  <i class="fas fa-undo"></i>
                  Withdraw
                </button>
                <button 
                  class="action-btn view-btn"
                  (click)="viewAuctionDetails(request.auctionId)"
                  title="View Auction Details">
                  <i class="fas fa-eye"></i>
                  View Auction
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Summary Section -->
    <div *ngIf="!loading && !error && requests.length > 0" class="summary-section content-card">
      <div class="card-header">
        <i class="fas fa-chart-bar"></i>
        <h3>Request Summary</h3>
      </div>
      <div class="card-body">
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-number">{{ requests.length }}</span>
            <span class="stat-label">Total Requests</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getPendingCount() }}</span>
            <span class="stat-label">Pending</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getAcceptedCount() }}</span>
            <span class="stat-label">Accepted</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getRejectedCount() }}</span>
            <span class="stat-label">Rejected</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getCompletedCount() }}</span>
            <span class="stat-label">Completed</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-RecyclerLayout> 