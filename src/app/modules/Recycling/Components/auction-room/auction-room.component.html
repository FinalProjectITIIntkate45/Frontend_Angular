<app-RecyclerLayout>
  <div class="auction-room-container">
    <!-- معلومات المزاد -->
    <div class="auction-info-section" *ngIf="auction">
      <h2>Auction</h2>
      <div class="auction-stats">
        <span class="stat-item">
          <i class="fas fa-users"></i>
          {{ bidHistory.length }} Bids
        </span>
        <span class="stat-item">
          <i class="fas fa-clock"></i>
          {{ countdown }}
        </span>
        <span class="stat-item" *ngIf="userRank > 0">
          <i class="fas fa-trophy"></i>
          Your Rank: {{ userRank }}
        </span>
      </div>
    </div>

    <!-- أعلى مزايدة -->
    <div class="max-bid-section" [class.bid-flash]="bidFlash">
      <h3>Highest Bid</h3>
      <div class="max-bid-value">{{ highestBid | number }} EGP</div>
      <div class="bid-count" *ngIf="bidHistory.length > 0">
        Total Bids: {{ bidHistory.length }}
      </div>
    </div>

    <!-- فورم تقديم مزايدة جديدة -->
    <div class="place-bid-section">
      <form (ngSubmit)="placeBid()" #bidForm="ngForm" autocomplete="off">
        <label for="bidAmount" class="form-label">Enter the new bid amount:</label>
        <input
          type="number"
          id="bidAmount"
          name="bidAmount"
          class="form-control"
          [(ngModel)]="bidAmount"
          [min]="highestBid + 1"
          required
          [disabled]="isPlacingBid"
          placeholder="Example: {{ highestBid + 10 }}"
        />
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isPlacingBid || !bidForm.form.valid"
        >
          <span *ngIf="!isPlacingBid">Place Bid</span>
          <span *ngIf="isPlacingBid">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Placing bid...
          </span>
        </button>
      </form>
      <div class="bid-message">
        <span class="success" *ngIf="bidSuccess">{{ bidSuccess }}</span>
        <span class="error" *ngIf="bidError">{{ bidError }}</span>
      </div>
    </div>

    <!-- الفيدباك المباشر -->
    <div class="live-feedback-section" *ngIf="liveFeedback.length > 0">
      <h4>
        <i class="fas fa-broadcast-tower"></i>
        Live Feedback
      </h4>
      <div class="live-feedback-list">
        <div class="feedback-item" *ngFor="let feedback of liveFeedback; trackBy: trackByFeedback">
          {{ feedback }}
        </div>
      </div>
    </div>

    <!-- الجداول الثلاثة جنب بعض -->
    <div class="bids-tables-row">
      <!-- أعلى 3 مزايدات -->
      <div class="top3-bids-section">
        <h4>
          <i class="fas fa-medal"></i>
          Top 3 Bids
        </h4>
        <table class="bids-table">
          <thead>
            <tr>
              <th>الترتيب</th>
              <th>المزايد</th>
              <th>القيمة</th>
              <th>الوقت</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let bid of top3Bids; trackBy: trackByBid" [class]="getPositionClass(bid.position)">
              <td>
                <span class="position-badge" [class]="getPositionClass(bid.position)">
                  {{ bid.position }}
                </span>
              </td>
              <td>{{ bid.recyclingName }}</td>
              <td>{{ bid.bid | number }}</td>
              <td>{{ getTimeAgo(bid.timestamp) }}</td>
            </tr>
            <tr *ngIf="top3Bids.length === 0">
              <td colspan="4" class="no-data">No bids yet</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- كل المزايدات السابقة -->
      <div class="all-bids-section">
        <h4>
          <i class="fas fa-history"></i>
          All Previous Bids
        </h4>
        <div style="max-height: 300px; overflow-y: auto;">
          <table class="bids-table">
            <thead>
              <tr>
                <th>Bid</th>
                <th>Value</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bid of bidHistory; trackBy: trackByBid">
                <td>{{ bid.recyclerName }}</td>
                <td>{{ bid.bidAmount | number }}</td>
                <td>{{ getTimeAgo(bid.createdAt) }}</td>
              </tr>
              <tr *ngIf="bidHistory.length === 0">
                <td colspan="3" class="no-data">No bids yet</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- مزايداتي أنا فقط -->
      <div class="my-bids-section">
        <h4>
          <i class="fas fa-user"></i>
          My Bids
        </h4>
        <div style="max-height: 300px; overflow-y: auto;">
          <table class="bids-table">
            <thead>
              <tr>
                <th>Value</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bid of myBids; trackBy: trackByBid">
                <td>{{ bid.bidAmount | number }}</td>
                <td>{{ getTimeAgo(bid.createdAt) }}</td>
              </tr>
              <tr *ngIf="myBids.length === 0">
                <td colspan="2" class="no-data">No bids yet</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ترتيب المستخدم -->
    <div class="user-rank-section" *ngIf="userRank > 0">
      <h4>Your Current Rank</h4>
      <div class="user-rank-display">
        <span class="rank-number">{{ userRank }}</span>
        <span class="rank-text">In the top 3 bidders list</span>
      </div>
    </div>

    <!-- معلومات إضافية -->
    <div class="additional-info" *ngIf="auction">
      <div class="info-grid">
        <div class="info-item">
          <i class="fas fa-calendar"></i>
          <span>Start Date: {{ auction.StartTime | date:'short' }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-calendar-check"></i>
          <span>End Date: {{ auction.EndTime | date:'short' }}</span>
        </div>
      </div>
    </div>
  </div>
</app-RecyclerLayout>