<app-RecyclerLayout (sectionChange)="onSectionChange($event)">
  <div class="dashboard-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state content-card">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading auction details...</p>
      </div>
    </div>

    <!-- Auction Details -->
    <div *ngIf="!isLoading && auction" class="auction-details-container">
      <!-- Main Auction Info -->
      <div class="auction-main-info content-card">
        <div class="card-header">
          <div class="auction-header">
            <h2>{{ auction.Matrialname }}</h2>
            <span class="auction-status" 
                  [class.active]="auction.AuctionStatus === 'Active'"
                  [class.pending]="auction.AuctionStatus === 'Pending'"
                  [class.closed]="auction.AuctionStatus === 'Closed'">
              {{ auction.AuctionStatus }}
            </span>
          </div>
        </div>
        
        <div class="card-body">
          <div class="auction-info-grid">
            <!-- Material Information -->
            <div class="info-item">
              <i class="fas fa-recycle"></i>
              <div class="info-content">
                <label>Material Type</label>
                <span>{{ auction.Matrialname }}</span>
              </div>
            </div>

            <div class="info-item">
              <i class="fas fa-hashtag"></i>
              <div class="info-content">
                <label>Material Number</label>
                <span>{{ auction.MaterialId }}</span>
              </div>
            </div>
            
            <!-- Location Information -->
            <div class="info-item">
              <i class="fas fa-map-marker-alt"></i>
              <div class="info-content">
                <label>Cities</label>
                <span>{{ auction.GovernorateName }}</span>
              </div>
            </div>
            
            <!-- Quantity Information -->
            <div class="info-item">
              <i class="fas fa-weight-hanging"></i>
              <div class="info-content">
                <label>Quantity</label>
                <span>{{ auction.quantity }} {{ getUnitTypeDisplayName(auction.UnitType) }}</span>
              </div>
            </div>

            <!-- Unit Type Information -->
            <div class="info-item">
              <i class="fas fa-ruler"></i>
              <div class="info-content">
                <label>Measurement Unit</label>
                <span>{{ getUnitTypeDisplayName(auction.UnitType) }}</span>
              </div>
            </div>
            
            <!-- Time Information -->
            <div class="info-item">
              <i class="fas fa-calendar-alt"></i>
              <div class="info-content">
                <label>Start Date</label>
                <span>{{ auction.StartTime | date:'fullDate' }}</span>
              </div>
            </div>
            
            <div class="info-item">
              <i class="fas fa-clock"></i>
              <div class="info-content">
                <label>End Date</label>
                <span>{{ auction.EndTime | date:'fullDate' }}</span>
              </div>
            </div>
            
            <!-- Financial Information -->
            <div class="info-item">
              <i class="fas fa-money-bill-wave"></i>
              <div class="info-content">
                <label>Insurance Amount</label>
                <span>{{ auction.InsuranceAmount | currency:'EGP':'symbol':'1.2-2' }}</span>
              </div>
            </div>

            <!-- Requests Count -->
            <div class="info-item">
              <i class="fas fa-users"></i>
              <div class="info-content">
                <label>Number of Requests</label>
                <span>{{ auction.RequestsCount }} Request</span>
              </div>
            </div>

            <!-- Creation Date -->
            <div class="info-item">
              <i class="fas fa-calendar-plus"></i>
              <div class="info-content">
                <label>Creation Date</label>
                <span>{{ auction.CreatedAt | date:'fullDate' }}</span>
              </div>
            </div>

            <!-- Auction ID -->
            <div class="info-item">
              <i class="fas fa-tag"></i>
              <div class="info-content">
                <label>Auction Number</label>
                <span>#{{ auction.Id }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Auction Actions -->
      <div class="auction-actions content-card">
        <div class="card-header">
          <h3>Auction Actions</h3>
        </div>
        <div class="card-body">
          <div class="actions-grid">
            <button class="action-btn primary" 
                    [routerLink]="['room', auction.Id]"
                    [disabled]="!isJoined">
              <i class="fas fa-sign-in-alt"></i>
              Join Auction Room
            </button>
            
            <button class="action-btn secondary" 
                    [routerLink]="['../auction-list']">
              <i class="fas fa-arrow-left"></i>
              Return to Auction List
            </button>
            
            <button *ngIf="!isJoined" 
                    class="action-btn success" 
                    (click)="createRequestToJoin()"
                    [disabled]="creatingRequest">
              <i class="fas fa-handshake"></i>
              {{ creatingRequest ? 'Creating request...' : 'Request to Join Auction' }}
            </button>
            
            <button *ngIf="isJoined" 
                    class="action-btn danger" 
                    (click)="withdrawRequest()"
                    [disabled]="withdrawingRequest">
              <i class="fas fa-times"></i>
              {{ withdrawingRequest ? 'Withdrawing request...' : 'Withdraw from Auction' }}
            </button>
          </div>
          
          <div *ngIf="!isJoined" class="join-info">
            <i class="fas fa-info-circle"></i>
            <p>You must request to join the auction first before entering the auction room</p>
          </div>

          <!-- Request Status Info -->
          <div *ngIf="currentRequest" class="request-status-info">
            <div class="status-card" [ngClass]="getStatusClass(currentRequest.status)">
              <i class="fas fa-info-circle"></i>
              <div class="status-content">
                <h4>Request Status</h4>
                <p>{{ getStatusText(currentRequest.status) }}</p>
                <small>Request Number: #{{ currentRequest.recyclingRequestId }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Winner Info (if auction completed) -->
      <div *ngIf="auction.AuctionStatus === 'Completed' && winner" class="winner-info content-card">
        <div class="card-header">
          <h3>Winner of the Auction</h3>
        </div>
        <div class="card-body">
          <div class="winner-details">
            <div class="winner-avatar">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="winner-info">
              <h4>{{ winner.recyclingCenterName || 'مستخدم' }}</h4>
              <p>Congratulations! You won the auction</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bidding Section -->
      <div class="bidding-section content-card">
        <div class="card-header">
            <h3>Bids</h3>
        </div>
        <div class="card-body">
          <!-- Max Bid Display -->
          <div *ngIf="maxBid" class="max-bid-info">
            <div class="max-bid-card">
              <i class="fas fa-crown"></i>
              <div class="max-bid-content">
                <h4>Highest Bid</h4>
                <span class="max-bid-amount">{{ maxBid.bidAmount | currency:'EGP':'symbol':'1.2-2' }}</span>
              </div>
            </div>
          </div>

          <!-- Bidding Form -->
          <div *ngIf="isJoined && auction.AuctionStatus === 'Active'" class="bidding-form">
            <div class="form-group">
              <label for="bidAmount">Bid Amount (EGP)</label>
              <input 
                type="number" 
                id="bidAmount"
                [(ngModel)]="bidAmount" 
                class="form-control"
                placeholder="Enter Bid Amount"
                min="0"
                step="0.01">
            </div>
            <button 
              class="action-btn primary" 
              (click)="placeBid()"
              [disabled]="!bidAmount || bidAmount <= 0">
              <i class="fas fa-gavel"></i>
              Place Bid
            </button>
            <div *ngIf="message" class="message" [class.error]="message.includes('خطأ')">
              {{ message }}
            </div>
          </div>

          <!-- Bids List -->
          <div class="bids-list">
            <h4>Bids Record</h4>
            <div *ngIf="bids.length === 0" class="no-bids">
              <i class="fas fa-info-circle"></i>
              <p>No bids yet</p>
            </div>
            <div *ngIf="bids.length > 0" class="bids-container">
              <div *ngFor="let bid of bids" class="bid-item">
                <div class="bid-amount">{{ bid.bidAmount | currency:'EGP':'symbol':'1.2-2' }}</div>
                <div class="bid-status">{{ bid.status }}</div>
                <div class="bid-date">{{ bid.createdAt | date:'short' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-RecyclerLayout>