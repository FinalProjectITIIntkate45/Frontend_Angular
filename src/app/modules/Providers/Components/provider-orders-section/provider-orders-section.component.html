<ng-container *ngIf="!loading() || filteredOrders().length || errorMessage()">
  <div class="container-fluid mt-4">
    <!-- Filters -->
    <div class="row mb-3 align-items-center">
      <div class="col-md-6">
        <div class="General-input-wrapper">
          <i class="fas fa-search"></i>
          <input
            type="text"
            class="General-custom-input General-light-input"
            placeholder="Search by client name or order ID"
            [value]="search()"
            (input)="search.set($any($event.target).value)"
          />
        </div>
      </div>

      <div class="col-md-3">
        <select
          class="General-custom-input General-light-input"
          [value]="statusFilter()"
          (change)="statusFilter.set($any($event.target).value)"
        >
          <option value="">Filter by Status</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>

      <div class="col-md-3 text-end">
        <button class="General-outlined-btn" (click)="clearFilters()">
          Reset Filters
        </button>
      </div>
    </div>

    <div *ngIf="loading()" class="text-center py-4">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Fetching orders, please wait...</p>
    </div>

    <div *ngIf="errorMessage() && !loading()" class="alert alert-danger">
      {{ errorMessage() }}
    </div>

    <table
      class="table table-striped table-bordered"
      *ngIf="!loading() && filteredOrders().length"
    >
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Client</th>
          <th>Phone</th>
          <th>Status</th>
          <th>Total</th>
          <th>Paid</th>
          <th>Payment Method</th>
          <th>Points Used</th>
          <th>Created</th>
          <th>Last Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of paginatedOrders(); let i = index">
          <td>
            <a
              [routerLink]="['/orders', order.Id]"
              class="text-decoration-none fw-bold"
            >
              #{{ order.Id }}
            </a>
          </td>

          <td>{{ order.CustomerInfo?.Name || order.ClientId }}</td>
          <td>{{ order.CustomerInfo?.PhoneNumber || "N/A" }}</td>
          <td>
            <span [class]="getStatusClass(order.Status)">
              {{ order.Status }}
            </span>
          </td>
          <td>
            {{
              order.TotalAmount != null
                ? (order.TotalAmount
                  | currency : "USD" : "symbol" : "1.2-2" : "en-US")
                : "N/A"
            }}
          </td>
          <td>
            <span
              [ngClass]="order.IsPaid ? 'text-success fw-bold' : 'text-danger'"
            >
              {{ order.IsPaid ? "Paid" : "Unpaid" }}
            </span>
          </td>
          <td>{{ order.PaymentMethodDisplay || "N/A" }}</td>
          <td>{{ order.UsedPaidPoints || 0 }}</td>
          <td>{{ order.CreationDateTime | date : "short" }}</td>
          <td>
            {{
              order.ModificationDateTime
                ? (order.ModificationDateTime | date : "short")
                : "â€”"
            }}
          </td>
          <td>
            <button
              class="btn btn-sm General-hover-btn me-1"
              *ngIf="order.Status?.toLowerCase() === 'pending'"
              (click)="updateOrderStatus(order.Id, OrderStatus.Confirmed)"
            >
              Confirm
            </button>

            <button
              class="btn btn-sm btn-danger"
              *ngIf="order.Status?.toLowerCase() !== 'cancelled'"
              (click)="updateOrderStatus(order.Id, OrderStatus.Canceled)"
            >
              Cancel
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div
      *ngIf="!loading() && !filteredOrders().length"
      class="text-center py-5"
    >
      <h5 class="text-muted">
        No orders found for the current search or filters.
      </h5>
    </div>

    <nav *ngIf="totalPages() > 1" class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage() === 1">
          <a
            class="page-link"
            href="#"
            (click)="previousPage(); $event.preventDefault()"
          >
            Previous
          </a>
        </li>
        <li
          *ngFor="let page of [].constructor(totalPages()); let i = index"
          class="page-item"
          [class.active]="currentPage() === i + 1"
        >
          <a
            class="page-link"
            href="#"
            (click)="goToPage(i + 1); $event.preventDefault()"
          >
            {{ i + 1 }}
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage() === totalPages()">
          <a
            class="page-link"
            href="#"
            (click)="nextPage(); $event.preventDefault()"
          >
            Next
          </a>
        </li>
      </ul>
    </nav>
  </div>
</ng-container>
