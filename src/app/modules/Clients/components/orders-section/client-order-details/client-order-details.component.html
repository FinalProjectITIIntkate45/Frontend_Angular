<!-- ✅ لكل منتج في الأوردر -->
<div *ngFor="let item of order?.Items" class="col-12 col-md-6 col-lg-4">
  <div class="order-product-card card h-100 shadow-sm border-0">
    <!-- بيانات المنتج -->
    <div class="d-flex align-items-center p-2">
      <img
        [src]="item.Image"
        alt="{{ item.ProductName }}"
        class="order-product-img me-3 rounded"
        style="
          width: 70px;
          height: 70px;
          object-fit: cover;
          background: #f8f9fa;
        "
      />
      <div class="flex-grow-1">
        <div class="fw-bold mb-1">{{ item.ProductName }}</div>
        <div class="text-muted small mb-1">{{ item.Description }}</div>
        <div class="text-muted small mb-1">
          Shop: <span class="fw-semibold">{{ item.ShopName }}</span>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-2">
          <span class="badge bg-light text-dark border"
            >Qty: {{ item.Quantity }}</span
          >
          <span class="badge bg-info text-dark">Points: {{ item.Points }}</span>
        </div>
      </div>
    </div>

    <!-- السعر -->
    <div class="order-product-pricing px-3 pb-2">
      <span
        *ngIf="
          item.PriceAfterDiscount && item.PriceAfterDiscount < (item.Price || 0)
        "
        class="text-success fw-bold me-2"
      >
        {{ item.PriceAfterDiscount | currency }}
      </span>
      <span
        *ngIf="
          item.PriceAfterDiscount && item.PriceAfterDiscount < (item.Price || 0)
        "
        class="text-muted text-decoration-line-through small"
      >
        {{ item.Price | currency }}
      </span>
      <span
        *ngIf="
          !item.PriceAfterDiscount ||
          item.PriceAfterDiscount >= (item.Price || 0)
        "
        class="fw-bold"
      >
        {{ item.PriceAfterDiscount | currency }}
      </span>
    </div>
    <!-- ✅ تقييم المنتج لو الأوردر تم توصيله -->
    <div *ngIf="order?.Status === 3" class="...">
      <ng-container
        *ngIf="
          getReviewForProduct(item.ProductId) as existingReview;
          else noReview
        "
      >
        <p class="text-success small mb-1">
          ✅ You've already reviewed this product.
        </p>
        <app-review-form
          [orderId]="order?.Id!"
          [productId]="item.ProductId"
          [isEdit]="true"
          [existingReview]="existingReview"
          (reviewSubmitted)="onReviewSubmitted($event)"
        ></app-review-form>
      </ng-container>

      <ng-template #noReview>
        <app-review-form
          [orderId]="order?.Id!"
          [productId]="item.ProductId"
          [isEdit]="false"
          (reviewSubmitted)="onReviewSubmitted($event)"
        ></app-review-form>
      </ng-template>
    </div>
  </div>
</div>
