<!-- لو جاري التحميل -->
<div *ngIf="loading" class="text-center p-4">
  <p>Loading order details...</p>
</div>

<!-- لو في خطأ -->
<div *ngIf="errorMessage" class="alert alert-danger">
  {{ errorMessage }}
</div>

<!-- تفاصيل الأوردر -->
<div *ngIf="order" class="card shadow-sm p-4">
  <h4>Order #{{ order.Id }}</h4>
  <p>
    <strong>Status:</strong> {{ getStatusText(order.Status) }}<br />
    <strong>Payment Type:</strong> {{ getPaymentTypeText(order.PaymentType)
    }}<br />
    <strong>Paid:</strong> {{ order.IsPaid ? "Yes" : "No" }}<br />
    <strong>Created:</strong> {{ order.DateCreated | date : "short" }}<br />
    <strong>Total Price:</strong> {{ order.TotalPrice | currency }}<br />
    <strong>Points Used:</strong>
    {{ order.UsedPaidPoints + order.UsedFreePoints }}<br />
    <strong>Points Earned:</strong> {{ order.EarnedPoints }}
  </p>

  <hr />
  <h5>Products:</h5>

  <!-- المنتجات -->
  <div *ngFor="let item of order.Items" class="border rounded p-2 mb-3">
    <div class="d-flex align-items-center">
      <img
        [src]="item.Image"
        alt="{{ item.ProductName }}"
        class="me-3"
        style="width: 60px; height: 60px"
      />
      <div>
        <strong>{{ item.ProductName }}</strong
        ><br />
        <span>{{ item.Description }}</span
        ><br />
        <span>Shop: {{ item.ShopName }}</span
        ><br />
        <span>Quantity: {{ item.Quantity }}</span
        ><br />
        <span
          >Price After Discount: {{ item.PriceAfterDiscount | currency }}</span
        ><br />
        <span>Points: {{ item.Points }}</span>
      </div>
    </div>

    <!-- ✅ تقييم المنتج لو الأوردر تم توصيله -->
    <!-- ✅ تقييم الأوردر (مرة واحدة) -->
    <div *ngIf="order.Status === 3" class="mt-3">
      <div *ngIf="reviews.length > 0; else addReview">
        <p class="text-success">✅ You've already reviewed this order.</p>
      </div>

      <ng-template #addReview>
        <app-review-form
          [orderId]="order.Id"
          [isEdit]="false"
        ></app-review-form>
      </ng-template>
    </div>
  </div>
</div>
